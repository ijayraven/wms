<?php
session_start();
error_reporting(E_ERROR);
include('/var/www/html/wms/includes/config.php');			// configuration
include('/var/www/html/wms/adodb/adodb.inc.php');			// adodb
include('/var/www/html/wms/includes/function.inc.php');	// global functions
######################################################################################################################################

	$Filstar_conn	=	ADONewConnection("mysqlt");
		
	$dbFilstar		=	$Filstar_conn->Connect(WMSSERVER,WMSUSER,WMSPASS,'FDCRMSlive');
	if ($dbFilstar == false) 
	{
		echo "<script>alert('Error Occurred no Database Connection!');</script>";
		echo "<script>location = 'index.php'</script>";
	}
	
	$Filstar_pms	=	ADONewConnection("mysql");
	$dbFilstar_pms	=	$Filstar_pms->Connect('192.168.250.171','root','','');
	if ($dbFilstar_pms == false) 
	{
		echo "<script>alert('Error Occurred no Database Connection!');</script>";
		echo "<script>location = 'index.php'</script>";
	}
	
	$global_func	=	new __Global_Func();

$Filstar_conn->StartTrans();	
	
$sofno		=	$argv[1];
//$sofno		=	'RT00004416';

//$nDiscount	=	30.000;
//$nUnitPrice	=	19.75;
//$nQty		=	60;
//
//$aData['Disc']        = AccntRound($nDiscount / 100, 2);
//$aData['DiscAmt']     = AccntRound(($nUnitPrice * $aData['Disc']), 2);
//$aData['GrossAmount'] = AccntRound(($nQty * $nUnitPrice), 2);
//$aData['DiscAmount']  = AccntRound(($aData['DiscAmt'] * $nQty), 2);
//$aData['NetAmount']   = AccntRound(($aData['GrossAmount'] - $aData['DiscAmount']), 2);

//print_r($aData);

//$sofno	=	"'RV00008445',
//'RV00008446',
//'RV00008447',
//'RV00008448',
//'RV00008449',
//'RV00008450',
//'RV00008451',
//'RV00008452',
//'RV00008453',
//'RV00008454',
//'RV00008455',
//'RV00008456',
//'RV00008457',
//'RV00008458',
//'RV00008459',
//'RV00008460',
//'RV00008461',
//'RV00008462',
//'RV00008463',
//'RV00008464',
//'RV00008465',
//'RV00008466',
//'RV00008467',
//'RV00008468',
//'RV00008469',
//'RV00008470',
//'RV00008471',
//'RV00008472',
//'RV00008474',
//'RV00008476',
//'RV00008478',
//'RV00008480',
//'RV00008481',
//'RV00008482',
//'RV00008483',
//'RV00008484',
//'RV00008486',
//'RV00008487',
//'RV00008488',
//'RV00008489',
//'RV00008490',
//'RV00008491',
//'RV00008492',
//'RV00008493',
//'RV00008494',
//'RV00008495',
//'RV00008496',
//'RV00008497',
//'RV00008498',
//'RV00008500',
//'RV00008501',
//'RV00008502',
//'RV00008504',
//'RV00008505',
//'RV00008506',
//'RV00008507',
//'RV00008508',
//'RV00008509',
//'RV00008510',
//'RV00008511',
//'RV00008512',
//'RV00008513',
//'RV00008514',
//'RV00008515',
//'RV00008516',
//'RV00008518',
//'RV00008520',
//'RV00008522',
//'RV00008524',
//'RV00008526',
//'RV00008528',
//'RV00008530',
//'RV00008531',
//'RV00008532',
//'RV00008534',
//'RV00008536',
//'RV00008537',
//'RV00008538',
//'RV00008540',
//'RV00008542',
//'RV00008544',
//'RV00008545',
//'RV00008546',
//'RV00008547',
//'RV00008548',
//'RV00008550',
//'RV00008552',
//'RV00008554',
//'RV00008556',
//'RV00008558',
//'RV00008560',
//'RV00008562',
//'RV00008563',
//'RV00008564',
//'RV00008565',
//'RV00008566',
//'RV00008568',
//'RV00008569',
//'RV00008570',
//'RV00008571',
//'RV00008572',
//'RV00008573',
//'RV00008574',
//'RV00008575',
//'RV00008576',
//'RV00008577',
//'RV00008578',
//'RV00008579',
//'RV00008580',
//'RV00008581',
//'RV00008582',
//'RV00008583',
//'RV00008584',
//'RV00008585',
//'RV00008586',
//'RV00008587',
//'RV00008588',
//'RV00008589',
//'RV00008590',
//'RV00008591',
//'RV00008592',
//'RV00008593',
//'RV00008594',
//'RV00008595',
//'RV00008596',
//'RV00008597',
//'RV00008598',
//'RV00008599',
//'RV00008600',
//'RV00008602',
//'RV00008604',
//'RV00008606',
//'RV00008608',
//'RV00008610',
//'RV00008612',
//'RV00008614',
//'RV00008615',
//'RV00008616',
//'RV00008618',
//'RV00008620',
//'RV00008622',
//'RV00008623',
//'RV00008624',
//'RV00008626',
//'RV00008628',
//'RV00008630',
//'RV00008632',
//'RV00008634',
//'RV00008635',
//'RV00008636',
//'RV00008638',
//'RV00008640',
//'RV00008642',
//'RV00008644',
//'RV00008645',
//'RV00008646',
//'RV00008648',
//'RV00008650',
//'RV00008651',
//'RV00008652',
//'RV00008653',
//'RV00008654',
//'RV00008656',
//'RV00008658',
//'RV00008659',
//'RV00008660',
//'RV00008662',
//'RV00008663',
//'RV00008664',
//'RV00009010',
//'RV00009011',
//'RV00009012',
//'RV00009013',
//'RV00009014',
//'RV00009015',
//'RV00009016',
//'RV00009017',
//'RV00009018',
//'RV00009019',
//'RV00009020',
//'RV00009021',
//'RV00009022',
//'RV00009023',
//'RV00009024',
//'RV00009025',
//'RV00009026',
//'RV00009027',
//'RV00009028',
//'RV00009029',
//'RV00009030',
//'RV00009031',
//'RV00009032',
//'RV00009033',
//'RV00009034',
//'RV00009035',
//'RV00009036',
//'RV00009037',
//'RV00009038',
//'RV00009039',
//'RV00009040',
//'RV00009041',
//'RV00009042',
//'RV00009043',
//'RV00009044',
//'RV00009045',
//'RV00009046',
//'RV00009047',
//'RV00009048',
//'RV00009049',
//'RV00009050',
//'RV00009051',
//'RV00009052',
//'RV00009053',
//'RV00009054',
//'RV00009055',
//'RV00009056',
//'RV00009057',
//'RV00009058',
//'RV00009059',
//'RV00009060',
//'RV00009079',
//'RV00009080',
//'RV00009081',
//'RV00009083',
//'RV00009084',
//'RV00009085',
//'RV00009086',
//'RV00009087',
//'RV00009089',
//'RV00009090',
//'RV00009091',
//'RV00009095',
//'RV00009102',
//'RV00009103',
//'RV00009104',
//'RV00009105',
//'RV00009106',
//'RV00009107',
//'RV00009108',
//'RV00009109',
//'RV00009110',
//'RV00009111',
//'RV00009112',
//'RV00009113',
//'RV00009114',
//'RV00009115',
//'RV00009116',
//'RV00009117',
//'RV00009118',
//'RV00009119',
//'RV00009120',
//'RV00009121',
//'RV00009122',
//'RV00009123',
//'RV00009124',
//'RV00009125',
//'RV00009126',
//'RV00009127',
//'RV00009128',
//'RV00009129',
//'RV00009130',
//'RV00009131',
//'RV00009132',
//'RV00009133',
//'RV00009134',
//'RV00009135',
//'RV00009136',
//'RV00009137',
//'RV00009138',
//'RV00009139',
//'RV00009140',
//'RV00009141',
//'RV00009142',
//'RV00009143',
//'RV00009144',
//'RV00009145',
//'RV00009146',
//'RV00009147',
//'RV00009148',
//'RV00009149',
//'RV00009150',
//'RV00009151',
//'RV00009152',
//'RV00009153',
//'RV00009154',
//'RV00009155',
//'RV00009156',
//'RV00009157',
//'RV00009158',
//'RV00009159',
//'RV00009160',
//'RV00009162',
//'RV00009163',
//'RV00009164',
//'RV00009165',
//'RV00009166',
//'RV00009167',
//'RV00009168',
//'RV00009169',
//'RV00009170',
//'RV00009171',
//'RV00009172',
//'RV00009173',
//'RV00009174',
//'RV00009175',
//'RV00009176',
//'RV00009177',
//'RV00009178',
//'RV00009179',
//'RV00009180',
//'RV00009181',
//'RV00009182',
//'RV00009183',
//'RV00009184',
//'RV00009185',
//'RV00009186',
//'RV00009187',
//'RV00009188',
//'RV00009189',
//'RV00009190',
//'RV00009191',
//'RV00009192',
//'RV00009193',
//'RV00009194',
//'RV00009195',
//'RV00009196',
//'RV00009197',
//'RV00009198',
//'RV00009199',
//'RV00009200',
//'RV00009201',
//'RV00009202',
//'RV00009203',
//'RV00009204',
//'RV00009205',
//'RV00009206',
//'RV00009207',
//'RV00009208',
//'RV00009209',
//'RV00009210',
//'RV00009211',
//'RV00009212',
//'RV00009213',
//'RV00009214',
//'RV00009215',
//'RV00009216',
//'RV00009217',
//'RV00009218',
//'RV00009219',
//'RV00009220',
//'RV00009221',
//'RV00009222',
//'RV00009223',
//'RV00009224',
//'RV00009225',
//'RV00009227',
//'RV00009228',
//'RV00009229',
//'RV00009230',
//'RV00009231',
//'RV00009232',
//'RV00009233',
//'RV00009234',
//'RV00009235',
//'RV00009236',
//'RV00009237',
//'RV00009238',
//'RV00009239',
//'RV00009240',
//'RV00009241',
//'RV00009242',
//'RV00009243',
//'RV00009244',
//'RV00009245',
//'TV00003845',
//'TV00004114'";

//$sofno	=	"'RV00008446',
//'RV00008448',
//'RV00008450',
//'RV00008452',
//'RV00008454',
//'RV00008456',
//'RV00008458',
//'RV00008460',
//'RV00008462',
//'RV00008464',
//'RV00008466',
//'RV00008468',
//'RV00008470',
//'RV00008472',
//'RV00008474',
//'RV00008476',
//'RV00008478',
//'RV00008480',
//'RV00008482',
//'RV00008484',
//'RV00008486',
//'RV00008488',
//'RV00008490',
//'RV00008492',
//'RV00008494',
//'RV00008496',
//'RV00008498',
//'RV00008500',
//'RV00008502',
//'RV00008504',
//'RV00008506',
//'RV00008508',
//'RV00008510',
//'RV00008512',
//'RV00008514',
//'RV00008516',
//'RV00008518',
//'RV00008520',
//'RV00008522',
//'RV00008524',
//'RV00008526',
//'RV00008528',
//'RV00008530',
//'RV00008532',
//'RV00008534',
//'RV00008536',
//'RV00008538',
//'RV00008540',
//'RV00008542',
//'RV00008544',
//'RV00008546',
//'RV00008548',
//'RV00008550',
//'RV00008552',
//'RV00008554',
//'RV00008556',
//'RV00008558',
//'RV00008560',
//'RV00008562',
//'RV00008564',
//'RV00008566',
//'RV00008568',
//'RV00008570',
//'RV00008572',
//'RV00008574',
//'RV00008576',
//'RV00008578',
//'RV00008580',
//'RV00008582',
//'RV00008584',
//'RV00008586',
//'RV00008588',
//'RV00008590',
//'RV00008592',
//'RV00008594',
//'RV00008596',
//'RV00008598',
//'RV00008600',
//'RV00008602',
//'RV00008604',
//'RV00008606',
//'RV00008608',
//'RV00008610',
//'RV00008612',
//'RV00008614',
//'RV00008616',
//'RV00008618',
//'RV00008620',
//'RV00008622',
//'RV00008624',
//'RV00008626',
//'RV00008628',
//'RV00008630',
//'RV00008632',
//'RV00008634',
//'RV00008636',
//'RV00008638',
//'RV00008640',
//'RV00008642',
//'RV00008644',
//'RV00008646',
//'RV00008648',
//'RV00008650',
//'RV00008652',
//'RV00008654',
//'RV00008656',
//'RV00008658',
//'RV00008660',
//'RV00008662',
//'RV00008664',
//'RV00009078',
//'RV00009079',
//'RV00009080',
//'RV00009081',
//'RV00009082',
//'RV00009083',
//'RV00009084',
//'RV00009085',
//'RV00009086',
//'RV00009087',
//'RV00009088',
//'RV00009089',
//'RV00009090',
//'RV00009091',
//'RV00009092',
//'RV00009093',
//'RV00009094',
//'RV00009095',
//'RV00009096',
//'RV00009097',
//'RV00009098',
//'RV00009099',
//'RV00009100',
//'RV00009101',
//'RV00009102',
//'RV00009103',
//'RV00009104',
//'RV00009105',
//'RV00009106',
//'RV00009107',
//'RV00009108',
//'RV00009109',
//'RV00009110',
//'RV00009111',
//'RV00009112',
//'RV00009113',
//'RV00009114',
//'RV00009115',
//'RV00009116',
//'RV00009117',
//'RV00009118',
//'RV00009119',
//'RV00009120',
//'RV00009121',
//'RV00009122',
//'RV00009123',
//'RV00009124',
//'RV00009125',
//'RV00009126',
//'RV00009127',
//'RV00009128',
//'RV00009129',
//'RV00009130',
//'RV00009131',
//'RV00009132',
//'RV00009133',
//'RV00009134',
//'RV00009135',
//'RV00009136',
//'RV00009137',
//'RV00009138',
//'RV00009139',
//'RV00009140',
//'RV00009141',
//'RV00009142',
//'RV00009143',
//'RV00009144',
//'RV00009145',
//'RV00009146',
//'RV00009147',
//'RV00009148',
//'RV00009149',
//'RV00009150',
//'RV00009151',
//'RV00009152',
//'RV00009153',
//'RV00009154',
//'RV00009155',
//'RV00009156',
//'RV00009157',
//'RV00009158',
//'RV00009159',
//'RV00009160',
//'RV00009161',
//'RV00009162',
//'RV00009163',
//'RV00009164',
//'RV00009165',
//'RV00009166',
//'RV00009167',
//'RV00009168',
//'RV00009169',
//'RV00009170',
//'RV00009171',
//'RV00009172',
//'RV00009173',
//'RV00009174',
//'RV00009175',
//'RV00009176',
//'RV00009177',
//'RV00009178',
//'RV00009179',
//'RV00009180',
//'RV00009181',
//'RV00009182',
//'RV00009183',
//'RV00009184',
//'RV00009185',
//'RV00009186',
//'RV00009187',
//'RV00009188',
//'RV00009189',
//'RV00009190',
//'RV00009191',
//'RV00009192',
//'RV00009193',
//'RV00009194',
//'RV00009195',
//'RV00009196',
//'RV00009197',
//'RV00009198',
//'RV00009199',
//'RV00009200',
//'RV00009201',
//'RV00009202',
//'RV00009203',
//'RV00009204',
//'RV00009205',
//'RV00009206',
//'RV00009207',
//'RV00009208',
//'RV00009209',
//'RV00009210',
//'RV00009211',
//'RV00009212',
//'RV00009213',
//'RV00009214',
//'RV00009215',
//'RV00009216',
//'RV00009217',
//'RV00009218',
//'RV00009219',
//'RV00009220',
//'RV00009221',
//'RV00009222',
//'RV00009223',
//'RV00009224',
//'RV00009225',
//'RV00009226',
//'RV00009227',
//'RV00009228',
//'RV00009229',
//'RV00009230',
//'RV00009231',
//'RV00009232',
//'RV00009233',
//'RV00009234',
//'RV00009235',
//'RV00009236',
//'RV00009237',
//'RV00009238',
//'RV00009239',
//'RV00009240',
//'RV00009241',
//'RV00009242',
//'RV00009243',
//'RV00009244',
//'RV00009245',
//'RV00009246',
//'RV00009287',
//'RV00009296',
//'RV00009304',
//'RV00009335',
//'RV00009336',
//'RV00009337',
//'RV00009338',
//'RV00009339',
//'RV00009340',
//'RV00009341',
//'RV00009342',
//'RV00009343',
//'RV00009344',
//'RV00009345',
//'RV00009346',
//'RV00009347',
//'RV00009348',
//'RV00009349',
//'RV00009350',
//'RV00009351',
//'RV00009352',
//'RV00009353',
//'RV00009354',
//'RV00009355',
//'RV00009356',
//'RV00009357',
//'RV00009358',
//'RV00009359',
//'RV00009360',
//'RV00009361',
//'RV00009362',
//'RV00009363',
//'RV00009364',
//'RV00009365',
//'RV00009366',
//'RV00009367',
//'RV00008446',
//'RV00008448',
//'RV00008450',
//'RV00008452',
//'RV00008454',
//'RV00008456',
//'RV00008458',
//'RV00008460',
//'RV00008462',
//'RV00008464',
//'RV00008466',
//'RV00008468',
//'RV00008470',
//'RV00008472',
//'RV00008474',
//'RV00008476',
//'RV00008478',
//'RV00008480',
//'RV00008482',
//'RV00008484',
//'RV00008486',
//'RV00008488',
//'RV00008490',
//'RV00008492',
//'RV00008494',
//'RV00008496',
//'RV00008498',
//'RV00008500',
//'RV00008502',
//'RV00008504',
//'RV00008506',
//'RV00008508',
//'RV00008510',
//'RV00008512',
//'RV00008514',
//'RV00008516',
//'RV00008518',
//'RV00008520',
//'RV00008522',
//'RV00008524',
//'RV00008526',
//'RV00008528',
//'RV00008530',
//'RV00008532',
//'RV00008534',
//'RV00008536',
//'RV00008538',
//'RV00008540',
//'RV00008542',
//'RV00008544',
//'RV00008546',
//'RV00008548',
//'RV00008550',
//'RV00008552',
//'RV00008554',
//'RV00008556',
//'RV00008558',
//'RV00008560',
//'RV00008562',
//'RV00008564',
//'RV00008566',
//'RV00008568',
//'RV00008570',
//'RV00008572',
//'RV00008574',
//'RV00008576',
//'RV00008578',
//'RV00008580',
//'RV00008582',
//'RV00008584',
//'RV00008586',
//'RV00008588',
//'RV00008590',
//'RV00008592',
//'RV00008594',
//'RV00008596',
//'RV00008598',
//'RV00008600',
//'RV00008602',
//'RV00008604',
//'RV00008606',
//'RV00008608',
//'RV00008610',
//'RV00008612',
//'RV00008614',
//'RV00008616',
//'RV00008618',
//'RV00008620',
//'RV00008622',
//'RV00008624',
//'RV00008626',
//'RV00008628',
//'RV00008630',
//'RV00008632',
//'RV00008634',
//'RV00008636',
//'RV00008638',
//'RV00008640',
//'RV00008642',
//'RV00008644',
//'RV00008646',
//'RV00008648',
//'RV00008650',
//'RV00008652',
//'RV00008654',
//'RV00008656',
//'RV00008658',
//'RV00008660',
//'RV00008662',
//'RV00008664',
//'RV00009287',
//'RV00009297',
//'RV00009305',
//'RV00008442',
//'RV00008446',
//'RV00008448',
//'RV00008450',
//'RV00008452',
//'RV00008454',
//'RV00008456',
//'RV00008458',
//'RV00008460',
//'RV00008462',
//'RV00008464',
//'RV00008466',
//'RV00008705',
//'RV00008706',
//'RV00008707',
//'RV00008708',
//'RV00008709',
//'RV00008710',
//'RV00008711',
//'RV00008712',
//'RV00008713',
//'RV00008714',
//'RV00008715',
//'RV00008716',
//'RV00008717',
//'RV00008718',
//'RV00008719',
//'RV00008720',
//'RV00008721',
//'RV00008722',
//'RV00008723',
//'RV00008724',
//'RV00008725',
//'RV00008726',
//'RV00008727',
//'RV00008728',
//'RV00008729',
//'RV00008730',
//'RV00008731',
//'RV00008732',
//'RV00008733',
//'RV00008734',
//'RV00008735',
//'RV00008736',
//'RV00008737',
//'RV00008738',
//'RV00008739',
//'RV00008740',
//'RV00008741',
//'RV00008742',
//'RV00008743',
//'RV00008744',
//'RV00008745',
//'RV00008746',
//'RV00008747',
//'RV00008748',
//'RV00008749',
//'RV00008750',
//'RV00008751',
//'RV00008752',
//'RV00008753',
//'RV00008754',
//'RV00008755',
//'RV00008756',
//'RV00008757',
//'RV00008758',
//'RV00008759',
//'RV00008760',
//'RV00008761',
//'RV00008762',
//'RV00008763',
//'RV00008764',
//'RV00008765',
//'RV00008766',
//'RV00008767',
//'RV00008768',
//'RV00008769',
//'RV00008770',
//'RV00008771',
//'RV00008772',
//'RV00008773',
//'RV00008774',
//'RV00008775',
//'RV00008776',
//'RV00008777',
//'RV00008778',
//'RV00008779',
//'RV00008780',
//'RV00008781',
//'RV00008782',
//'RV00008783',
//'RV00008784',
//'RV00008785',
//'RV00008786',
//'RV00008787',
//'RV00008788',
//'RV00009288',
//'RV00009297',
//'RV00009305',
//'TV00004366'";

//$sofno	=	"'TT00004647',
//'RV00009680',
//'RV00009681',
//'RV00009689',
//'RV00009690',
//'RV00010022',
//'RV00010053',
//'RV00010054',
//'RV00010055',
//'RV00010019',
//'RV00010044',
//'RV00010049',
//'RV00010050',
//'RV00010051',
//'RV00010052',
//'RV00009923',
//'RV00009924',
//'RV00010074',
//'RV00010023',
//'RV00010068',
//'RT00009391',
//'RV00009732',
//'RV00009733',
//'RV00009722',
//'RV00009734',
//'RV00009735',
//'RV00009736',
//'RV00009997',
//'RV00009998',
//'RV00009995',
//'TC00006743',
//'RT00009460',
//'RV00009701',
//'RV00009627',
//'RV00009837',
//'RV00010028',
//'RV00009918',
//'RV00009919',
//'RV00009925',
//'RV00009926',
//'RV00009927',
//'RV00009902',
//'RV00009903',
//'RV00009905',
//'RV00010024',
//'RV00010046',
//'RV00010047'";


//$sel_h		=	"SELECT `OrderNo`,`CustNo`,`OrderCategory` FROM orderheader WHERE OrderNo IN ({$sofno}) ";
$sel_h		=	"SELECT `OrderNo`,`CustNo`,`OrderCategory` FROM orderheader WHERE OrderNo IN ('{$sofno}') ";
$rssel_h	=	$Filstar_conn->Execute($sel_h);
if ($rssel_h==false) 
{
	echo $Filstar_conn->ErrorMsg()."::".__LINE__;exit();
}
while (!$rssel_h->EOF) 
{
	$SOF			=	$rssel_h->fields['OrderNo'];
	$CUSTNO			=	$rssel_h->fields['CustNo'];
	$OrderCategory	=	$rssel_h->fields['OrderCategory'];
	
	$sel_d	=	"SELECT * from orderdetail WHERE OrderNo = '{$SOF}' ";
	$rssel_d=	$Filstar_conn->Execute($sel_d);
	if ($rssel_d==false) 
	{
		echo $Filstar_conn->ErrorMsg()."::".__LINE__;exit();
	}
	$total_net=0;
	$total_qty=0;
	while (!$rssel_d->EOF) 
	{
		$SKUNO	=	$rssel_d->fields['Item'];
		$QTY	=	$rssel_d->fields['ReleaseQty'];
		
		$PriceClass		=	$global_func->Select_val($Filstar_conn,FDCRMS,"itemmaster","PriceClass","ItemNo = '".$SKUNO."'");
		
		$CustPriceBook	=	$global_func->Select_val($Filstar_conn,FDCRMS,"custmast","CustPriceBook","CustNo = '{$CUSTNO}' and CustStatus = 'A' ");
		
		$DISC1			=	$global_func->Select_val($Filstar_conn,FDCRMS,"custdiscount","Discount","PriceBook = '{$CustPriceBook}' and PriceClass = '{$PriceClass}'");
		
		
		$UnitPrice		=	$global_func->Select_val($Filstar_conn,FDCRMS,"orderdetail","UnitPrice","OrderNo = '{$SOF}' and Item = '{$SKUNO}'");
		$ReleaseQty		=	$global_func->Select_val($Filstar_conn,FDCRMS,"orderdetail","ReleaseQty","OrderNo = '{$SOF}' and Item = '{$SKUNO}'");
		
		$aData['Disc']        = AccntRound($DISC1 / 100, 2);
		$aData['DiscAmt']     = AccntRound(($UnitPrice * $aData['Disc']), 2);
		//echo $aData['DiscAmt']."\n";
		$aData['GrossAmount'] = AccntRound(($QTY * $UnitPrice), 2);
		$aData['DiscAmount']  = AccntRound(($aData['DiscAmt'] * $QTY), 2);
		$aData['NetAmount']   = AccntRound(($aData['GrossAmount'] - $aData['DiscAmount']), 2);
		$discount			  = AccntRound($aData['GrossAmount']-$aData['NetAmount'],2);
		$UnitCost			  = AccntRound($UnitPrice-$aData['DiscAmt'],2);
		//print_r($aData);exit();
		
		if($OrderCategory=='Invoice')
		{
			$total_net		+=	$aData['NetAmount'];
			$total_qty		+=	$QTY;
		}
		else 
		{
			//$net_hdr		=	AccntRound($UnitPrice*$QTY,2);
			$total_net		+=	$aData['GrossAmount'];
			$total_qty		+=	$QTY;
		}
		
		
		$update_dtl 	=	"UPDATE orderdetail set UnitCost = '{$UnitCost}', Discount = '{$DISC1}', DiscAmount = '{$discount}', NetAmount = '{$aData['NetAmount']}' where OrderNo = '{$SOF}' and Item = '{$SKUNO}'";
		echo $update_dtl."\n";
		$rsupdate_dtl	=	$Filstar_conn->Execute($update_dtl);
		if ($rsupdate_dtl==false) 
		{
			echo $Filstar_conn->ErrorMsg()."::".__LINE__;exit();
		}
		$rssel_d->MoveNext();
	}
	
	$UPDATE_HDR		=	"UPDATE orderheader SET InvoiceAmount = '{$total_net}' WHERE OrderNo = '{$SOF}' ";
	$rsupdate_hdr	=	$Filstar_conn->Execute($UPDATE_HDR);
	if ($rsupdate_hdr==false) 
	{
		echo $Filstar_conn->ErrorMsg()."::".__LINE__;exit();
	}
	$rssel_h->MoveNext();
}

$Filstar_conn->CompleteTrans();

//function AccntRound($num, $round)
//{
//    $num_parts = explode(".",$num);
//    $plusvals  = "0.".str_pad(1,$round,0,STR_PAD_LEFT);
//
//    $firstdrop   = substr($num_parts[1],$round,1);
//    $lastkept    = substr($num_parts[1],$round-1,1);
//    $succeedvals = substr($num_parts[1],$round+1);
//
//    if ($firstdrop > 5)
//    {
//        $fpart = $num_parts[0];
//        $spart = (substr($num_parts[1],0,$round)) + 1;
//    }
//    elseif ($firstdrop < 5)
//    {
//        $fpart = $num_parts[0];
//        $spart = substr($num_parts[1],0,$round);
//    }
//    elseif ($firstdrop == 5 && $succeedvals == "" || $succeedvals == 0)
//    {
//        if (in_array($lastkept,array(0,2,4,6,8)))
//        {
//            $fpart = $num_parts[0];
//            $spart = substr($num_parts[1],0,$round);
//        }
//        else 
//        {
//            $fpart = $num_parts[0];
//            $spart = (substr($num_parts[1],0,$round)) + 1;
//        }
//    }
//    elseif ($firstdrop == 5 && $succeedvals != "" || $succeedvals > 0)
//    {
//        $fpart = $num_parts[0];
//        $spart = (substr($num_parts[1],0,$round)) + 1;
//    }
//
//    $newnum = str_pad($fpart,1,0,STR_PAD_LEFT).".".str_pad($spart,$round,0,STR_PAD_RIGHT);
//    
//    return $newnum;
//}

function AccntRound($num,$round)
	{
		$num_parts   = explode(".",$num);
	    $dec         = $num_parts[1];
	    $zeroval     = substr($dec,0,1);
	    $plusvals    = "0.".str_pad(1,$round,0,STR_PAD_LEFT);
		$firstdrop   = substr($dec,$round,1);
	    $lastkept    = substr($dec,$round-1,1);
	    $succeedvals = substr($dec,$round+1);
	
	    if ($firstdrop > 5)
	    {
	        $fpart = $num_parts[0];
	        
	        if ($zeroval == 0)
	        {
	        	$spart = $zeroval.((substr($dec,0,$round)) + 1);
	        }
	        else 
	        {
	        	$spart = (substr($dec,0,$round)) + 1;
	        }
	    }
	    elseif ($firstdrop < 5)
	    {
	        $fpart = $num_parts[0];
	        $spart = substr($dec,0,$round);
	    }
	    elseif ($firstdrop == 5 && $succeedvals == "" || $succeedvals == 0)
	    {
	        if (in_array($lastkept,array(0,2,4,6,8)))
	        {
	            $fpart = $num_parts[0];
	            $spart = substr($dec,0,$round);
	        }
	        else 
	        {
	            $fpart = $num_parts[0];
	            if ($zeroval == 0)
	            {
	            	$spart = $zeroval.((substr($dec,0,$round)) + 1);
	            }
	            else 
	            {
	            	$spart = (substr($dec,0,$round)) + 1;
	            }
	        }
	    }
	    elseif ($firstdrop == 5 && $succeedvals != "" || $succeedvals > 0)
	    {
	        $fpart = $num_parts[0];
	        
	        if ($zeroval == 0)
	        {
	        	$spart = $zeroval.((substr($dec,0,$round)) + 1);
	        }
	        else 
	        {
	        	$spart = (substr($dec,0,$round)) + 1;
	        }
	    }
	
	    $newnum = str_pad($fpart,1,0,STR_PAD_LEFT).".".str_pad($spart,$round,0,STR_PAD_RIGHT);
	    
	    return $newnum;
	}

?>
